<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VaultIt: A Browser-Based Password Manager</title>
    <link rel="stylesheet" href="style.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,700;1,300&family=Poppins:wght@300;400;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans', sans-serif;
            font-family: 'Poppins', sans-serif;
        }

        nav {
            background-color: black;
            color: white;
            padding: 12px 3px;
            display: flex;
            justify-content: space-between;
        }

        .logo {
            margin: 0 23px;
            font-weight: 800;
            font-size: 25px;
            cursor: pointer;
        }

        ul {
            display: flex;
            margin: 0 23px;
            align-items: center;
        }

        ul > li {
            list-style: none;
            margin: 0 13px;
            cursor: pointer;
        }

        table, td, tr, th {
            border: 2px solid black;
            border-collapse: collapse;
            padding: 5px 13px;
        }

        .container {
            max-width: 80vw;
            margin: 23px auto;
        }

        h1, h2 {
            margin: 23px 0;
        }

        .btn, .btnsm {
            padding: 8px 17px;
            background: black;
            color: white;
            font-weight: 900;
            border: 2px solid gray;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
        }

        img {
            cursor: pointer;
            position: relative;
            bottom: 3px;
            width: 15px;
            height: 15px;
        }

        #alert {
            display: none;
            color: green;
            font-weight: bold;
        }

        progress {
            width: 100%;
            height: 15px;
        }
    </style>
</head>
<body>
    <nav>
        <div class="logo">VaultIt</div>
        <ul>
            <li>Home</li>
            <li>About</li>
            <li>Contact</li>
        </ul>
    </nav>

    <div class="container">
        <h1>Password Manager</h1>
        <p>We're thrilled to have you here. Your digital life contains a myriad of passwords, and we know how
            challenging it can be to manage them all. That's why we're here to make it easy for you.</p>

        <h2>Your Passwords <span id="alert">(Copied!)</span></h2> 
        <table>
            <tr>
                <th>Website</th>
                <th>Username</th>
                <th>Password</th>
                <th>Delete</th>
            </tr> 
        </table>

        <h2>Add a Password</h2>
        <form>
            <label for="website">Website:</label>
            <input type="text" id="website" name="website" required>
            <br><br>

            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>
            <br><br>

            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required oninput="updateStrengthMeter(this.value)">
            <br><br>

            <progress id="strengthBar" max="4" value="0"></progress>
            <br>
            <button type="button" onclick="generatePassword()" class="btnsm">Generate Strong Password</button>
            <br>

            <button class="btn" type="submit">Submit</button>
        </form>
    </div>

    <!-- CryptoJS CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <script>
        let secretKey = "MySecretKey123"; // Change this for more security

        function encryptData(data) {
            return CryptoJS.AES.encrypt(data, secretKey).toString();
        }

        function decryptData(data) {
            return CryptoJS.AES.decrypt(data, secretKey).toString(CryptoJS.enc.Utf8);
        }

        function maskPassword(pass) {
            let str = "";
            for (let index = 0; index < pass.length; index++) {
                str += "*";
            }
            return str;
        }

        function copyText(txt) {
            navigator.clipboard.writeText(txt).then(
                () => {
                    document.getElementById("alert").style.display = "inline";
                    setTimeout(() => {
                        document.getElementById("alert").style.display = "none";
                    }, 2000);
                },
                () => {
                    alert("Clipboard copying failed");
                },
            );
        }

        const deletePassword = (website) => {
            let data = localStorage.getItem("passwords");
            let arr = JSON.parse(data);
            let arrUpdated = arr.filter((e) => {
                return e.website !== website;
            });
            localStorage.setItem("passwords", JSON.stringify(arrUpdated));
            alert(`Successfully deleted ${website}'s password`);
            showPasswords();
        };

        const showPasswords = () => {
            let tb = document.querySelector("table");
            let data = localStorage.getItem("passwords");
            if (data == null || JSON.parse(data).length == 0) {
                tb.innerHTML = "<tr><td colspan='4' style='text-align:center'>No Data To Show</td></tr>";
            } else {
                tb.innerHTML = `<tr>
                    <th>Website</th>
                    <th>Username</th>
                    <th>Password</th>
                    <th>Delete</th>
                </tr>`;
                let arr = JSON.parse(data);
                let str = "";
                for (let index = 0; index < arr.length; index++) {
                    const element = arr[index];
                    str += `<tr>
                        <td>${element.website} <img onclick="copyText('${element.website}')" src="./copy.svg" alt="Copy"></td>
                        <td>${element.username} <img onclick="copyText('${element.username}')" src="./copy.svg" alt="Copy"></td>
                        <td>${maskPassword(decryptData(element.password))} <img onclick="copyText('${decryptData(element.password)}')" src="./copy.svg" alt="Copy"></td>
                        <td><button class="btnsm" onclick="deletePassword('${element.website}')">Delete</button></td>
                    </tr>`;
                }
                tb.innerHTML += str;
            }
            website.value = "";
            username.value = "";
            password.value = "";
            updateStrengthMeter("");
        };

        function updateStrengthMeter(pass) {
            let strengthBar = document.getElementById("strengthBar");
            let strength = 0;
            if (pass.length >= 8) strength++;
            if (/[A-Z]/.test(pass)) strength++;
            if (/[0-9]/.test(pass)) strength++;
            if (/[^A-Za-z0-9]/.test(pass)) strength++;
            strengthBar.value = strength;
        }

        function generatePassword() {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()";
            let pass = "";
            for (let i = 0; i < 12; i++) {
                pass += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            password.value = pass;
            updateStrengthMeter(pass);
        }

        console.log("Working");
        showPasswords();

        document.querySelector(".btn").addEventListener("click", (e) => {
            e.preventDefault();
            let existingData = localStorage.getItem("passwords");
            if (existingData) {
                let arr = JSON.parse(existingData);
                if (arr.some(item => item.website === website.value)) {
                    alert("Password for this website already exists!");
                    return;
                }
            }

            let passwords = localStorage.getItem("passwords");
            let encryptedPassword = encryptData(password.value);
            if (passwords == null) {
                let json = [];
                json.push({ website: website.value, username: username.value, password: encryptedPassword });
                alert("Password Saved");
                localStorage.setItem("passwords", JSON.stringify(json));
            } else {
                let json = JSON.parse(passwords);
                json.push({ website: website.value, username: username.value, password: encryptedPassword });
                alert("Password Saved");
                localStorage.setItem("passwords", JSON.stringify(json));
            }
            showPasswords();
        });
    </script>
</body>
</html>